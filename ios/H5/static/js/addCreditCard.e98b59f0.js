(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["addCreditCard"],{"0e3e":function(t,e,a){"use strict";var i=a("5a40"),n=a.n(i);n.a},"135d":function(t,e,a){},5515:function(t,e,a){"use strict";var i,n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"bgfff"},[a("div",[t._m(0),a("div",{staticClass:"search_warp"},[a("i",{staticClass:"icon_search"}),a("input",{directives:[{name:"model",rawName:"v-model",value:t.searchValue,expression:"searchValue"}],staticClass:"search_input",attrs:{type:"text",placeholder:"请输入银行名称关键词"},domProps:{value:t.searchValue},on:{input:function(e){e.target.composing||(t.searchValue=e.target.value)}}})])]),a("div",{staticClass:"search_content"},[a("mt-index-list",{attrs:{height:312}},[t.searchValue?t._e():a("mt-index-section",{attrs:{index:""}},[a("li",[a("p",{staticClass:"line mint-indexsection-index"},[t._v("\n            热门银行\n          ")]),a("div",{staticClass:"hot_list"},t._l(t.bankHotListArr,(function(e,i){return a("div",{key:i,staticClass:"box",attrs:{index:i}},[a("div",{staticClass:"search_item",on:{click:function(a){return t.clickCard(e)}}},[a("div",{staticClass:"text"},[t._v("\n                  "+t._s(e.name)+"\n                ")])])])})),0)])]),t._l(t.bankListArr,(function(e,i){return a("mt-index-section",{key:i,attrs:{index:i}},t._l(e,(function(e,i){return a("li",{key:i,staticClass:"search_item",on:{click:function(a){return t.clickCard(e)}}},[t._v("\n          "+t._s(e.name)+"\n        ")])})),0)}))],2)],1)])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"search_title"},[a("h5",{staticClass:"size36 color333"},[t._v("\n        选择银行\n      ")])])}],l=a("76a0");a("8635"),a("f1a6");function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var o={name:"SelectCard",components:(i={},r(i,l["IndexList"].name,l["IndexList"]),r(i,l["IndexSection"].name,l["IndexSection"]),i),data:function(){return{bankListArr:{},bankHotListArr:{},searchValue:"",resultsList:""}},computed:{bankList:function(){return this.$store.state.bankList}},watch:{searchValue:function(t,e){var a=String(t).toUpperCase(),i=[];this.resultsList.forEach((function(t){-1===String(t.name).indexOf(a)&&-1===String(t.first_pinyin_letter).indexOf(a)||i.push(t)})),this.bankListArr=i.reduce((function(t,e){return t[e.first_pinyin_letter[0]]||(t[e.first_pinyin_letter[0]]=[]),t[e.first_pinyin_letter[0]].push(e),t}),{}),this.bankListArr=this.objKeySort(this.bankListArr)}},created:function(){this.getBankListFun()},methods:{thisTitle:function(){document.title="选择银行卡"},getBankListFun:function(){var t=this;t.$api.card.getBankList().then((function(e){t.resultsList=e.data.data.bank_list,t.bankHotListArr=e.data.data.hot_bank_list,console.log(t.resultsList),t.bankListArr=t.resultsList.reduce((function(t,e){return console.log(t),console.log(e),t[e.first_pinyin_letter[0]]||(t[e.first_pinyin_letter[0]]=[]),t[e.first_pinyin_letter[0]].push(e),t}),{}),t.bankListArr=t.objKeySort(t.bankListArr)}))},objKeySort:function(t){console.log(t);var e=Object.keys(t).sort();console.log(e);for(var a={},i=0;i<e.length;i++)a[e[i]]=t[e[i]];return a},clickCard:function(t){this.$emit("selectCard",t)}}},c=o,d=(a("f7a6"),a("2877")),u=Object(d["a"])(c,n,s,!1,null,"44f3eda2",null);e["a"]=u.exports},"5a40":function(t,e,a){},c506:function(t,e,a){"use strict";function i(t,e){if("cardNo"===e){var a=t;return a=a.replace(/\s/g,"").replace(/\D/g,"").replace(/(\d{4})(?=\d)/g,"$1 "),a}if("identifyNo"===e){var i=t;return i=i.replace(/\s/g,"").replace(/[^0-9X]/g,"").replace(/(\d{6})(?=\d)/,"$1 ").replace(/(\d{8})(?=\d)/,"$1 "),i}}e["a"]={name:"card-no-input",data:function(){return{previousValue:null}},props:{value:{type:String},numType:{type:String}},render:function(t){var e=this,a=i(e.value,e.numType);return e.previousValue=a,t("input",{attrs:{placeholder:e.$attrs.placeholder,disabled:e.$attrs.disabled},class:{form_input:!0,bold:e.value},domProps:{value:a},on:{keyup:function(t){var a=t.target;if(a.selectionStart<e.previousValue.length)e.previousValue=t.target.value;else{e.previousValue=t.target.value;var n=i(t.target.value,e.numType),s=n.replace(/\s/g,"");e.$emit("input",n),e.$emit("onRawValue",s),t.target.value=i(t.target.value,e.numType)}},blur:function(t){var a=i(t.target.value,e.numType),n=a.replace(/\s/g,"");e.$emit("input",a),e.$emit("onRawValue",n),t.target.value=i(t.target.value,e.numType)}}})}}},d099:function(t,e,a){"use strict";a.r(e);var i,n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",["add"===t.status||t.fromSelectCardPage?a("top-msg",{attrs:{"header-name":"添加信用卡"}}):t._e(),"edit"===t.status?a("top-msg",{attrs:{"header-name":"编辑信用卡"}}):t._e(),a("div",{staticClass:"con_body"},[a("div",{staticClass:"form_cells form_cells_form bgfff"},[a("div",{staticClass:"form_cell"},[t._m(0),a("div",{staticClass:"form_cellBd"},[t.auth?a("fun-components-input",{attrs:{disabled:!0,"num-type":"cardNo",placeholder:"请输入信用卡号"},on:{onRawValue:function(e){t.creditCardNo=e}},model:{value:t.creditCardNoShow,callback:function(e){t.creditCardNoShow=e},expression:"creditCardNoShow"}}):a("fun-components-input",{attrs:{disabled:!1,"num-type":"cardNo",placeholder:"请输入信用卡号"},on:{onRawValue:function(e){t.creditCardNo=e}},model:{value:t.creditCardNoShow,callback:function(e){t.creditCardNoShow=e},expression:"creditCardNoShow"}})],1)]),a("div",{staticClass:"form_cell"},[t._m(1),a("div",{staticClass:"form_cellBd",on:{click:function(e){!t.auth&&(t.bankPicker=!0)}}},[t.bankSelect.name?a("span",{staticClass:"size30"},[t._v(t._s(t.bankSelect.name))]):a("span",{staticClass:"size30",staticStyle:{color:"#BEBEBE"}},[t._v("请选择所属银行")])])]),a("div",{staticClass:"form_cell"},[t._m(2),a("div",{staticClass:"form_cellBd"},[t.auth?a("input",{directives:[{name:"model",rawName:"v-model",value:t.CVN2,expression:"CVN2"}],staticClass:"form_input",attrs:{disabled:"",placeholder:"信用卡背后三位数字"},domProps:{value:t.CVN2},on:{input:function(e){e.target.composing||(t.CVN2=e.target.value)}}}):a("input",{directives:[{name:"model",rawName:"v-model",value:t.CVN2,expression:"CVN2"}],staticClass:"form_input",attrs:{type:"number",placeholder:"信用卡背后三位数字"},domProps:{value:t.CVN2},on:{input:function(e){e.target.composing||(t.CVN2=e.target.value)}}})])]),a("div",{staticClass:"form_cell"},[t._m(3),a("div",{staticClass:"form_cellBd"},[t.auth?a("input",{directives:[{name:"model",rawName:"v-model",value:t.validityMonthSelect,expression:"validityMonthSelect"}],class:t.validityMonthSelect?"form_input form_input-small2 size30 inline_block":"form_input form_input-small size30 inline_block",attrs:{placeholder:"请输入月份",disabled:""},domProps:{value:t.validityMonthSelect},on:{input:function(e){e.target.composing||(t.validityMonthSelect=e.target.value)}}}):a("input",{directives:[{name:"model",rawName:"v-model",value:t.validityMonthSelect,expression:"validityMonthSelect"}],class:t.validityMonthSelect?"form_input form_input-small2 size30 inline_block":"form_input form_input-small size30 inline_block",attrs:{type:"number",placeholder:"请输入月份"},domProps:{value:t.validityMonthSelect},on:{input:function(e){e.target.composing||(t.validityMonthSelect=e.target.value)}}}),t.validityMonthSelect?a("span",[t._v("月")]):t._e(),a("span",{staticClass:"w10 inline_block cen",staticStyle:{color:"#BEBEBE"}},[t._v(" / ")]),t.auth?a("input",{directives:[{name:"model",rawName:"v-model",value:t.validityYearSelect,expression:"validityYearSelect"}],class:t.validityYearSelect?"form_input form_input-small2 size30 inline_block":"form_input form_input-small size30 inline_block",attrs:{placeholder:"请输入年份",disabled:""},domProps:{value:t.validityYearSelect},on:{input:function(e){e.target.composing||(t.validityYearSelect=e.target.value)}}}):a("input",{directives:[{name:"model",rawName:"v-model",value:t.validityYearSelect,expression:"validityYearSelect"}],class:t.validityYearSelect?"form_input form_input-small2 size30 inline_block":"form_input form_input-small size30 inline_block",attrs:{type:"number",placeholder:"请输入年份"},domProps:{value:t.validityYearSelect},on:{input:function(e){e.target.composing||(t.validityYearSelect=e.target.value)}}}),t.validityYearSelect?a("span",[t._v("年")]):t._e()])]),[a("div",{staticClass:"form_cell clear",on:{click:function(e){t.showDatetimePicker=!0,t.isUse=!0}}},[t._m(4),a("div",{staticClass:"form_cellBd"},[t.useDateList.selectedDate?t._e():a("input",{staticClass:"form_input",attrs:{type:"number",placeholder:"请设置账单日"}}),t.useDateList.selectedDate?a("span",{staticClass:"form_input"},[t._v(t._s(t.useDateList.selectedDate))]):t._e()]),a("van-icon",{staticClass:"rt",attrs:{name:"arrow"}})],1),a("div",{staticClass:"form_cell clear",on:{click:function(e){t.showDatetimePicker=!0,t.isUse=!1}}},[t._m(5),a("div",{staticClass:"form_cellBd"},[t.repayDateList.selectedDate?t._e():a("input",{staticClass:"form_input",attrs:{type:"number",placeholder:"请设置到期日"}}),t.repayDateList.selectedDate?a("span",{staticClass:"form_input"},[t._v(t._s(t.repayDateList.selectedDate))]):t._e()]),a("van-icon",{staticClass:"rt",attrs:{name:"arrow"}})],1),a("van-popup",{staticClass:"picker-box",attrs:{position:"bottom",overlay:!0},model:{value:t.showDatetimePicker,callback:function(e){t.showDatetimePicker=e},expression:"showDatetimePicker"}},[a("van-picker",{attrs:{"show-toolbar":"",title:t.isUse?"请设置账单日":"请选择到期日期",columns:t.columns},on:{confirm:t.confirmFun,cancel:t.cancelFun}})],1)],a("div",{staticClass:"form_cell"},[t._m(6),a("div",{staticClass:"form_cellBd"},[t.auth?a("input",{directives:[{name:"model",rawName:"v-model",value:t.tel,expression:"tel"}],staticClass:"form_input",attrs:{type:"number",placeholder:"请输入预留手机号",disabled:""},domProps:{value:t.tel},on:{input:function(e){e.target.composing||(t.tel=e.target.value)}}}):a("input",{directives:[{name:"model",rawName:"v-model",value:t.tel,expression:"tel"}],staticClass:"form_input",attrs:{type:"number",placeholder:"请输入预留手机号"},domProps:{value:t.tel},on:{input:function(e){e.target.composing||(t.tel=e.target.value)}}})])])],2),"add"===t.status||t.fromSelectCardPage?a("div",{class:[t.fromSelectCardPage?"btn-add bottom-btn":"btn_warp"]},[a("button",{staticClass:"btn btn_add",on:{click:t.addCreditCardFun}},[t._v("\n        "+t._s(t.fromSelectCardPage?"确认添加":"保  存")+"\n      ")])]):"edit"===t.status?a("div",{staticClass:"btn_warp"},[a("button",{staticClass:"btn btn_add",on:{click:t.editCardFUn}},[t._v("\n        保  存\n      ")])]):t._e()]),a("van-popup",{attrs:{position:"bottom"},model:{value:t.bankPicker,callback:function(e){t.bankPicker=e},expression:"bankPicker"}},[a("choose-card",{on:{selectCard:t.selectCard}})],1),t.bgShow?a("div",{staticStyle:{width:"100%",height:"100%",position:"fixed",top:"0",left:"0",bottom:"0",background:"#000",opacity:"0.5"}}):t._e()],1)},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form_cellHd"},[a("label",{staticClass:"form_label"},[t._v("银行卡号")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form_cellHd"},[a("label",{staticClass:"form_label"},[t._v("所属银行")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form_cellHd"},[a("label",{staticClass:"form_label"},[t._v("CVN2")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form_cellHd"},[a("label",{staticClass:"form_label"},[t._v("有效期")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form_cellHd"},[a("label",{staticClass:"form_label"},[t._v("账单日")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form_cellHd"},[a("label",{staticClass:"form_label"},[t._v("到期日")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form_cellHd"},[a("label",{staticClass:"form_label"},[t._v("预留手机号")])])}],l=(a("d1cf"),a("ee83")),r=(a("5f5f"),a("f253")),o=a("2c92"),c=(a("5b4d"),a("5515")),d=a("c506");function u(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var m={name:"AddCreditCard",components:(i={topMsg:o["a"]},u(i,r["a"].name,r["a"]),u(i,"chooseCard",c["a"]),u(i,l["a"].name,l["a"]),u(i,"FunComponentsInput",d["a"]),i),props:["fromSelectCardPage","hideAddCard"],data:function(){return{bgShow:!1,columns:[],isUse:!0,minDate:new Date,currentDate:new Date,showDatetimePicker:!1,useDateList:{num:"1",selectedDate:"每月1号"},repayDateList:{num:"31",selectedDate:"每月31号"},status:this.$util.getQueryVariable("status"),cardUser:"",creditCardNo:"",creditCardNoShow:"",cardName:"",CVN2:"",validity:"",tel:"",sms_code:"",isGetCode:!1,num:60,timer:"",cardId:this.$util.getQueryVariable("cardId"),bankSelect:{},bankPicker:!1,bankListArr:[],validityMonthPicker:!1,validityMonthList:[],validityMonthSelect:"",validityYearPicker:!1,validityYearList:[],validityYearSelect:"",handler:function(t){t.preventDefault()},auth:!1}},computed:{bankList:function(){return this.$store.state.bankList}},watch:{CVN2:function(){this.CVN2.length>3&&(this.CVN2=this.CVN2.substr(0,3))},validityMonthSelect:function(){this.validityMonthSelect.length>2&&(this.validityMonthSelect=this.validityMonthSelect.substr(0,2))},validityYearSelect:function(){this.validityYearSelect.length>2&&(this.validityYearSelect=this.validityYearSelect.substr(0,2))},tel:function(){this.tel.length>11&&(this.tel=this.tel.substr(0,11))}},created:function(){this.thisTitle(),this.getBankListFun();for(var t=1;t<13;t++)t<10?this.validityMonthList.push("0"+t):this.validityMonthList.push(t);for(var e=18;e<100;e++)this.validityYearList.push(e);for(var a=0;a<31;a++)this.columns.push("每月"+(a+1)+"号");"edit"===this.status&&this.getCardMsg(),this.$route.query.auth&&(this.auth=this.$route.query.auth,this.validityMonthSelect="**",this.validityYearSelect="**")},methods:{confirmFun:function(t,e){this.showDatetimePicker=!1;var a={};a.num=e+1,a.selectedDate=t,this.isUse?Object.assign(this.useDateList,a):Object.assign(this.repayDateList,a)},cancelFun:function(){this.showDatetimePicker=!1},thisTitle:function(){"add"===this.status?document.title="添加信用卡":document.title=this.fromSelectCardPage?"添加信用卡":"编辑信用卡"},getCodeFun:function(){var t=this,e=function(e){return t.$dialog({title:e,showCancelButton:!1,confirmButtonText:"确定",cancelButtonText:"确定",className:"dialog",closeOnClickOverlay:!0})};if(t.cardUser)if(t.creditCardNo)if(t.tel)if(t.$util.isPhone(t.tel)){var a={bank_card_account_name:t.cardUser,card_no:t.creditCardNo,card_phone_number:t.tel};t.isGetCode||(t.isGetCode=!0,t.$api.card.getVerificationCode("CREDIT",a).then((function(e){console.log(e),t.$toast({message:"短信发送成功",position:"middle"})})),t.timer=setInterval((function(){0!==t.num?t.num--:(t.isGetCode=!1,t.num=60,clearInterval(t.timer))}),1e3))}else e("请输入正确的手机号码");else e("请输入您的手机号码");else e("请输入您的信用卡号");else e("请输入持卡人姓名")},addCreditCardFun:function(){var t=this,e=this,a=function(t){return e.$dialog({title:t,showCancelButton:!1,confirmButtonText:"确定",className:"dialog",closeOnClickOverlay:!0})},i=/^(1[0-2]|[1-9]|0[1-9])$/,n=/^(19|[2-9][0-9])$/;if(e.creditCardNo)if(e.creditCardNo.length>19)a("输入信用卡号长度过长");else if(e.bankSelect)if(e.tel)if(e.$util.isPhone(e.tel))if(e.CVN2&&3===e.CVN2.length)if(e.validityMonthSelect||e.validityYearSelect)if(i.test(e.validityMonthSelect))if(n.test(e.validityYearSelect))if(e.useDateList.num)if(e.repayDateList.num)if(Math.abs(parseInt(e.useDateList.num)-parseInt(e.repayDateList.num))<2)a("账单日和到期日间隔必须大于等于一天");else{e.validityMonthSelect<10&&String(e.validityMonthSelect).length<2&&(e.validityMonthSelect="0"+e.validityMonthSelect);var s={bank_no:e.bankSelect.bank_no,card_no:e.creditCardNo,card_phone_number:e.tel,lass_three_cvn2:e.CVN2,valid_date:(e.validityMonthSelect+"").concat(e.validityYearSelect),bill_date:e.useDateList.num,repayment_date:e.repayDateList.num};e.bgShow=!0,e.$api.card.bindCard("CREDIT",s).then((function(i){t.fromSelectCardPage?(t.hideAddCard(),t.$emit("toReflesh")):a("添加信用卡成功").then((function(t){e.$router.go(-1)}))})).catch((function(t){console.log(t),e.bgShow=!1}))}else a("请设置到期日");else a("请设置账单日");else a("请输入正确的有效期年份（输入年份后两位）");else a("请输入正确的有效期月份（01-12）");else a("请输入有效期");else a("请输入信用卡背后三位数字");else a("请输入正确的手机号码");else a("请输入预留手机号码");else a("请选择所属银行");else a("请输入您的信用卡号")},getCardMsg:function(){var t=this;t.$api.card.getCard("CREDIT",this.cardId).then((function(e){console.log(e),e=e.data,t.creditCardNo=e.data.card_no,t.creditCardNoShow=e.data.card_no,t.$set(t.bankSelect,"name",e.data.bank_info.name),t.$set(t.bankSelect,"bank_no",e.data.bank_info.bank_no),t.tel=e.data.card_phone_number,t.useDateList={num:e.data.bill_date||1,selectedDate:t.columns[e.data.bill_date-1||0]},t.repayDateList={num:e.data.repayment_date||31,selectedDate:t.columns[e.data.repayment_date-1||30]},t.CVN2=e.data.lass_three_cvn2})).catch((function(t){console.log(t)}))},editCardFUn:function(){var t=this,e=function(e){return t.$dialog({title:e,showCancelButton:!1,confirmButtonText:"确定",className:"dialog",closeOnClickOverlay:!0})};if(t.creditCardNo)if(t.bankSelect)if(t.tel)if(t.CVN2)if(t.validityMonthSelect||t.validityYearSelect||t.auth)if(t.auth){var a={bill_date:t.useDateList.num,repayment_date:t.repayDateList.num};t.$api.card.partEditCard(t.cardId,"CREDIT",a).then((function(a){e("编辑信用卡成功").then((function(e){t.$router.go(-1)}))}))}else{var i={bank_no:t.bankSelect.bank_no,card_no:t.creditCardNo,card_phone_number:t.tel,lass_three_cvn2:t.CVN2,valid_date:(t.validityMonthSelect+"").concat(t.validityYearSelect),bill_date:t.useDateList.num,repayment_date:t.repayDateList.num};t.$api.card.editCard(t.cardId,"CREDIT",i).then((function(a){e("编辑信用卡成功").then((function(e){t.$router.go(-1)}))}))}else e("请输入请输入有效期");else e("请输入信用卡背后三位数字");else e("请输入预留手机号码");else e("请选择所属银行");else e("请输入您的信用卡号")},closeStatusPicker:function(t){this.bankSelect=t,this.bankPicker=!1},closeValidityMonth:function(t){this.validityMonthSelect=t,this.validityMonthPicker=!1},closeValidityYear:function(t){this.validityYearSelect=t,this.validityYearPicker=!1},getBankListFun:function(){var t=this;t.$store.dispatch("GetBankList").then((function(){for(var e in t.bankList)t.bankListArr.push({bankNo:e,text:t.bankList[e]})}))},closeTouch:function(){document.getElementsByTagName("body")[0].addEventListener("touchmove",this.handler,{passive:!1}),console.log("closeTouch haved happened.")},openTouch:function(){document.getElementsByTagName("body")[0].removeEventListener("touchmove",this.handler,{passive:!1}),console.log("openTouch haved happened.")},selectCard:function(t){this.bankSelect=t,this.bankPicker=!1},validityMonthChange:function(t){console.log(t),this.validityMonthSelect=t},validityYearChange:function(t){console.log(t),this.validityYearSelect=t}}},v=m,h=(a("0e3e"),a("2877")),f=Object(h["a"])(v,n,s,!1,null,"9406e73c",null);e["default"]=f.exports},f7a6:function(t,e,a){"use strict";var i=a("135d"),n=a.n(i);n.a}}]);
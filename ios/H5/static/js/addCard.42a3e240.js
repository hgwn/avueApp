(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["addCard"],{"3b79":function(t,e,a){},5515:function(t,e,a){"use strict";var n,r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"bgfff"},[a("div",[t._m(0),a("div",{staticClass:"search_warp"},[a("i",{staticClass:"icon_search"}),a("input",{directives:[{name:"model",rawName:"v-model",value:t.searchValue,expression:"searchValue"}],staticClass:"search_input",attrs:{type:"text",placeholder:"请输入银行名称关键词"},domProps:{value:t.searchValue},on:{input:function(e){e.target.composing||(t.searchValue=e.target.value)}}})])]),a("div",{staticClass:"search_content"},[a("mt-index-list",{attrs:{height:312}},[t.searchValue?t._e():a("mt-index-section",{attrs:{index:""}},[a("li",[a("p",{staticClass:"line mint-indexsection-index"},[t._v("\n            热门银行\n          ")]),a("div",{staticClass:"hot_list"},t._l(t.bankHotListArr,(function(e,n){return a("div",{key:n,staticClass:"box",attrs:{index:n}},[a("div",{staticClass:"search_item",on:{click:function(a){return t.clickCard(e)}}},[a("div",{staticClass:"text"},[t._v("\n                  "+t._s(e.name)+"\n                ")])])])})),0)])]),t._l(t.bankListArr,(function(e,n){return a("mt-index-section",{key:n,attrs:{index:n}},t._l(e,(function(e,n){return a("li",{key:n,staticClass:"search_item",on:{click:function(a){return t.clickCard(e)}}},[t._v("\n          "+t._s(e.name)+"\n        ")])})),0)}))],2)],1)])},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"search_title"},[a("h5",{staticClass:"size36 color333"},[t._v("\n        选择银行\n      ")])])}],s=a("76a0");a("8635"),a("f1a6");function c(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var o={name:"SelectCard",components:(n={},c(n,s["IndexList"].name,s["IndexList"]),c(n,s["IndexSection"].name,s["IndexSection"]),n),data:function(){return{bankListArr:{},bankHotListArr:{},searchValue:"",resultsList:""}},computed:{bankList:function(){return this.$store.state.bankList}},watch:{searchValue:function(t,e){var a=String(t).toUpperCase(),n=[];this.resultsList.forEach((function(t){-1===String(t.name).indexOf(a)&&-1===String(t.first_pinyin_letter).indexOf(a)||n.push(t)})),this.bankListArr=n.reduce((function(t,e){return t[e.first_pinyin_letter[0]]||(t[e.first_pinyin_letter[0]]=[]),t[e.first_pinyin_letter[0]].push(e),t}),{}),this.bankListArr=this.objKeySort(this.bankListArr)}},created:function(){this.getBankListFun()},methods:{thisTitle:function(){document.title="选择银行卡"},getBankListFun:function(){var t=this;t.$api.card.getBankList().then((function(e){t.resultsList=e.data.data.bank_list,t.bankHotListArr=e.data.data.hot_bank_list,console.log(t.resultsList),t.bankListArr=t.resultsList.reduce((function(t,e){return console.log(t),console.log(e),t[e.first_pinyin_letter[0]]||(t[e.first_pinyin_letter[0]]=[]),t[e.first_pinyin_letter[0]].push(e),t}),{}),t.bankListArr=t.objKeySort(t.bankListArr)}))},objKeySort:function(t){console.log(t);var e=Object.keys(t).sort();console.log(e);for(var a={},n=0;n<e.length;n++)a[e[n]]=t[e[n]];return a},clickCard:function(t){this.$emit("selectCard",t)}}},l=o,d=(a("9b87"),a("2877")),u=Object(d["a"])(l,r,i,!1,null,"2cfd1e14",null);e["a"]=u.exports},"6d97":function(t,e,a){"use strict";var n=a("3b79"),r=a.n(n);r.a},"826b":function(t,e,a){},"9b87":function(t,e,a){"use strict";var n=a("826b"),r=a.n(n);r.a},a86c:function(t,e,a){"use strict";a.r(e);var n,r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",["add"===t.status||t.fromSelectCardPage?a("top-msg",{attrs:{"header-name":"添加储蓄卡"}}):t._e(),"edit"===t.status?a("top-msg",{attrs:{"header-name":"编辑储蓄卡"}}):t._e(),a("div",{staticClass:"con_body"},[a("div",{staticClass:"form_cells form_cells_form bgfff"},[a("div",{staticClass:"form_cell"},[t._m(0),a("div",{staticClass:"form_cellBd"},[a("fun-components-input",{attrs:{"num-type":"cardNo",placeholder:"请输入您的储蓄卡号"},on:{onRawValue:function(e){t.cardNo=e}},model:{value:t.cardNoShow,callback:function(e){t.cardNoShow=e},expression:"cardNoShow"}})],1)]),a("div",{staticClass:"form_cell"},[t._m(1),a("div",{staticClass:"form_cellBd",on:{click:function(e){t.bankPicker=!0}}},[t.bankSelect.name?a("span",{staticClass:"size30"},[t._v(t._s(t.bankSelect.name))]):a("span",{staticClass:"size30",staticStyle:{color:"#BEBEBE"}},[t._v("请选择所属银行")])])]),a("div",{staticClass:"form_cell"},[t._m(2),a("div",{staticClass:"form_cellBd"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.tel,expression:"tel"}],staticClass:"form_input",attrs:{type:"number",placeholder:"请输入预留手机号"},domProps:{value:t.tel},on:{input:function(e){e.target.composing||(t.tel=e.target.value)}}})])])]),a("div",{staticClass:"form_cells form_cells_form bgfff"},[a("div",{staticClass:"form_cell",on:{click:function(e){t.showSelectAddress=!0}}},[t._m(3),a("div",{staticClass:"form_cellBd",staticStyle:{color:"#a9a9a9"}},[t._v("\n          "+t._s(t.extraData.province?t.extraData.province+"-"+t.extraData.city:"请选择省/市")+"\n        ")])]),a("div",{staticClass:"form_cell"},[t._m(4),a("div",{staticClass:"form_cellBd"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.extraData.branch_name,expression:"extraData.branch_name",modifiers:{trim:!0}}],staticClass:"form_input",attrs:{type:"text",placeholder:"请输入支行名"},domProps:{value:t.extraData.branch_name},on:{input:function(e){e.target.composing||t.$set(t.extraData,"branch_name",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])])]),"add"===t.status||t.fromSelectCardPage?a("div",{class:[t.fromSelectCardPage?"btn-add":"btn_warp"]},[a("button",{staticClass:"btn btn_add",on:{click:t.addCardFun}},[t._v("\n        "+t._s(t.fromSelectCardPage?"确认添加":"保  存")+"\n      ")])]):"edit"===t.status?a("div",{staticClass:"btn_warp"},[a("button",{staticClass:"btn btn_add",on:{click:t.editCardFUn}},[t._v("\n        保  存\n      ")])]):t._e()]),a("van-popup",{attrs:{position:"bottom"},model:{value:t.bankPicker,callback:function(e){t.bankPicker=e},expression:"bankPicker"}},[a("choose-card",{on:{selectCard:t.selectCard}})],1),a("van-popup",{staticClass:"picker",attrs:{position:"bottom"},model:{value:t.showSelectAddress,callback:function(e){t.showSelectAddress=e},expression:"showSelectAddress"}},[a("van-area",{attrs:{"area-list":t.areaList,"columns-num":2,title:"选择省市"},on:{confirm:t.confirmArea,cancel:t.concalArea}})],1),t.bgShow?a("div",{staticStyle:{width:"100%",height:"100%",position:"fixed",top:"0",left:"0",bottom:"0",background:"#000",opacity:"0.5"}}):t._e()],1)},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form_cellHd"},[a("label",{staticClass:"form_label"},[t._v("储蓄卡号")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form_cellHd"},[a("label",{staticClass:"form_label"},[t._v("所属银行")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form_cellHd"},[a("label",{staticClass:"form_label"},[t._v("预留手机号")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form_cellHd"},[a("label",{staticClass:"form_label"},[t._v("省 / 市")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form_cellHd"},[a("label",{staticClass:"form_label"},[t._v("支行名")])])}],s=(a("5f5f"),a("f253")),c=a("2c92"),o=(a("5b4d"),a("5515")),l=a("c506"),d=a("494e");function u(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var f={name:"AddCard",components:(n={topMsg:c["a"]},u(n,s["a"].name,s["a"]),u(n,"chooseCard",o["a"]),u(n,"FunComponentsInput",l["a"]),n),props:["fromSelectCardPage","hideAddCard"],data:function(){return{bgShow:!1,status:this.$util.getQueryVariable("status"),cardUser:"",cardNo:"",cardNoShow:"",tel:"",code:"",isGetCode:!1,num:60,timer:"",cardId:this.$util.getQueryVariable("cardId"),bankNo:"",bankSelect:{},bankPicker:!1,bankListArr:[],extraData:{branch_name:"",card_no:"",province:"",city:""},showSelectAddress:!1,areaList:Object.freeze(d["a"])}},computed:{token:function(){return this.$store.state.token},bankList:function(){return this.$store.state.bankList}},created:function(){this.thisTitle(),this.getBankListFun(),"edit"===this.status&&(this.getCardMsg(),this.x_getCardMsg())},methods:{thisTitle:function(){"add"===this.static?document.title="添加储蓄卡":document.title=this.fromSelectCardPage?"添加储蓄卡":"编辑储蓄卡"},input:function(t){this.cardNo=t},getCodeFun:function(){var t=this,e=function(e){return t.$dialog({title:e,showCancelButton:!1,confirmButtonText:"确定",cancelButtonText:"确定",className:"dialog",closeOnClickOverlay:!0})};t.tel?t.$util.isPhone(t.tel)?t.isGetCode||(t.isGetCode=!0,t.timer=setInterval((function(){0!==t.num?t.num--:(t.isGetCode=!1,t.num=60,clearInterval(t.timer))}),1e3)):e("请输入正确的手机号码"):e("请输入您的手机号码")},addCardFun:function(){var t=this,e=this,a=function(t){return e.$dialog({title:t,showCancelButton:!1,confirmButtonText:"确定",className:"dialog",closeOnClickOverlay:!0})};if(e.cardNo)if(e.bankSelect)if(e.tel)if(e.extraData.province)if(e.extraData.branch_name){console.log("====打印银行卡......"),console.log(e.extraData);var n={bank_no:e.bankSelect.bank_no,card_no:e.cardNo,card_phone_number:e.tel,province:e.extraData.province,city:e.extraData.city,branch_name:e.extraData.branch_name};e.bgShow=!0,e.$api.card.bindCard("DEBIT",n).then((function(n){t.fromSelectCardPage?(t.hideAddCard(),t.$emit("toReflesh")):a("添加储蓄卡成功").then((function(t){e.$router.go(-1)})),e.bgShow=!1})).catch((function(t){console.log(t),e.bgShow=!1}))}else a("请输入支行名称");else a("请选择省 / 市");else a("请输入预留手机号码");else a("请输入所属银行");else a("请输入储蓄卡号")},getCardMsg:function(){var t=this;t.$api.card.getCard("DEBIT",this.cardId).then((function(e){e=e.data,t.cardNo=e.data.card_no,t.cardNoShow=e.data.card_no,t.$set(t.bankSelect,"name",e.data.bank_info.name),t.$set(t.bankSelect,"bank_no",e.data.bank_info.bank_no),t.tel=e.data.card_phone_number}))},x_getCardMsg:function(){var t=this,e=this;e.$api.card.x_getCard("DEBIT",this.cardId).then((function(e){console.log("x_getCard res: ",e);var a=e.data.data;Object.keys(t.extraData).forEach((function(e){a.hasOwnProperty(e)&&(t.extraData[e]=a[e])}))}))},editCardFUn:function(){var t=this,e=function(e){return t.$dialog({title:e,showCancelButton:!1,confirmButtonText:"确定",className:"dialog",closeOnClickOverlay:!0})};if(t.cardNo)if(t.bankSelect)if(t.tel){var a={bank_no:t.bankSelect.bank_no,card_no:t.cardNo,card_phone_number:t.tel};t.$api.card.editCard(t.cardId,"DEBIT",a).then((function(a){e("编辑储蓄卡成功").then((function(e){t.$router.go(-1)}))}))}else e("请输入预留手机号码");else e("请输入所属银行");else e("请输入储蓄卡号")},closeStatusPicker:function(t){console.log(t),this.bankSelect=t,this.bankPicker=!1},getBankListFun:function(){var t=this;t.$store.dispatch("GetBankList").then((function(){for(var e in t.bankList)t.bankListArr.push({bankNo:e,text:t.bankList[e]})}))},selectCard:function(t){this.bankSelect=t,this.bankPicker=!1},saveExtraData:function(){var t=this;console.log("this.extraData: ",this.extraData);var e=this,a=function(t){return e.$dialog({title:t,showCancelButton:!1,confirmButtonText:"确定",className:"dialog",closeOnClickOverlay:!0})};e.cardNo?e.extraData.branch_name?e.extraData.province?e.extraData.city?(e.extraData.card_no=e.cardNo,"add"===e.status?e.$api.card.x_bindCard("DEBIT",e.extraData).then((function(n){t.fromSelectCardPage?(t.hideAddCard(),t.$emit("toReflesh")):a("添加代付信息成功").then((function(t){e.$router.go(-1)}))})).catch((function(t){console.log(t)})):"edit"===e.status&&e.$api.card.x_editCard(e.cardId,"DEBIT",e.extraData).then((function(t){a("编辑代付信息成功").then((function(t){e.$router.go(-1)}))}))):a("请输入市"):a("请输入省份"):a("请输入支行名"):a("请输入储蓄卡号")},confirmArea:function(t){console.log("confirmArea data: ",t),this.showSelectAddress=!1,t&&(this.extraData.province=t[0].name,this.extraData.city=t[1].name,console.log("this.extraData: ",this.extraData))},concalArea:function(){this.showSelectAddress=!1}}},m=f,h=(a("6d97"),a("2877")),_=Object(h["a"])(m,r,i,!1,null,"3cf9b80b",null);e["default"]=_.exports},c506:function(t,e,a){"use strict";function n(t,e){if("cardNo"===e){var a=t;return a=a.replace(/\s/g,"").replace(/\D/g,"").replace(/(\d{4})(?=\d)/g,"$1 "),a}if("identifyNo"===e){var n=t;return n=n.replace(/\s/g,"").replace(/[^0-9X]/g,"").replace(/(\d{6})(?=\d)/,"$1 ").replace(/(\d{8})(?=\d)/,"$1 "),n}}e["a"]={name:"card-no-input",data:function(){return{previousValue:null}},props:{value:{type:String},numType:{type:String}},render:function(t){var e=this,a=n(e.value,e.numType);return e.previousValue=a,t("input",{attrs:{placeholder:e.$attrs.placeholder,disabled:e.$attrs.disabled},class:{form_input:!0,bold:e.value},domProps:{value:a},on:{keyup:function(t){var a=t.target;if(a.selectionStart<e.previousValue.length)e.previousValue=t.target.value;else{e.previousValue=t.target.value;var r=n(t.target.value,e.numType),i=r.replace(/\s/g,"");e.$emit("input",r),e.$emit("onRawValue",i),t.target.value=n(t.target.value,e.numType)}},blur:function(t){var a=n(t.target.value,e.numType),r=a.replace(/\s/g,"");e.$emit("input",a),e.$emit("onRawValue",r),t.target.value=n(t.target.value,e.numType)}}})}}}}]);